<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link href="static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css" />
<link href="lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<style>
 .dashed{
   border:1px dashed #ddd;
   text-align: right;
   padding-left: 15px;
   padding-right: 15px;
 }
</style>
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>商品新增</title>
</head>
<body>
<div class="page-container">
	<form action="SystemBack/addGoods" method="post" class="form form-horizontal" id="form-article-add">
	    <!-- <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>SKU：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="sku" name="sku">
			</div>
		</div> -->
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="goods_name" name="goods_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
				<select name="goods_class" id="goods_class" class="select">
				    
				</select>
				</span>
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>上架状态：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
				<select name="sale" class="select">
					<option value="on">上架</option>
					<option value="off">下架</option>
				</select>
				</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="商品价格" id="price" name="price">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">增加规格</label>
			<div class="formControls col-xs-8 col-sm-9" >
			    <div class="dashed" style="padding-right: 20px;padding-top: 20px;padding-bottom: 20px;">
			      <div class="specItem" style="margin-bottom: 15px;">
				      <input type="text" style="width:24%" class="input-text" value="" placeholder="" disabled id="spec_sku" name="spec_sku">
				      <input type="text" style="width:24%" class="input-text" value="" placeholder="请填写规格名称" id="spec_name" name="spec_name">
				      <input type="text" style="width:24%;" class="input-text" value="" placeholder="请填写价格" id="spec_price" name="spec_price">
				      <span class="btn-upload form-group" style="width:22%">
						<input class="input-text upload-url" type="text" name="spec_Img" id="spec_Img" placeholder="请选择图片" readonly nullmsg="请添加附件！" style="width:100px">
						<input type="file" accept="image/*"  name="specImgFile" class="input-file">
					 </span>
					 <i class="Hui-iconfont" style="cursor: pointer;" onclick="delSpecItem(this)">&#xe6e2;</i> 
				 </div>
				 <div style="margin-right: 77px;margin-top: 20px;">
				   <i class="Hui-iconfont" onclick="addSpec(this)" style="cursor: pointer;position: absolute;bottom: 5px;">&#xe600;增加规格</i>
			     </div>
			    </div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="品牌" id="brand" name="brand">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第一品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="firstBrand" name="firstBrand">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第二品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="secondBrand" name="secondBrand">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">相关链接：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="introduceUrl" name="introduceUrl">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第三方参照价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="introducePrice" name="introducePrice">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品说明：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="introduce" cols="" rows="" class="textarea"  placeholder="" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" ></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">图标：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="iconImg" id="iconImg" readonly nullmsg="请添加附件！" style="width:200px">
				<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" accept="image/*"  name="iconImgfile" class="input-file">
				</span>
			</div>
		</div>
	    <!-- <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">大图：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="bigImg" id="bigImg" readonly nullmsg="请添加附件！" style="width:200px">
				<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" accept="image/*"  name="bigImgfile" class="input-file">
				</span>
			</div>
		</div>  -->
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">图片列表：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="imgList" id="imgList" readonly nullmsg="请添加附件！" style="width:200px">
				<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" accept="image/*" multiple name="imgListfile" class="input-file">
				</span>
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button  class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i>提交</button>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> 
<script type="text/javascript" src="lib/webuploader/0.1.5/webuploader.min.js"></script> 
</body>

<script>

$(function(){
	//初始化商品类别列表
	initGoodsClassOption();
	//初始化时获取第一个商品类别的sku序列
	$("#spec_sku").val(getSkuSeq($("#goods_class option:selected").val()));
	//商品类别变化时  将增加的类别重新获取其sku序列
	$("#goods_class").change(function(){
		var goods_class=$(this).find("option:selected").val();
		$(".specItem").each(function(){
			$(this).find("#spec_sku").val(getSkuSeq(goods_class));
		});
	});
});

function initGoodsClassOption(){
	$.ajax({
		url:"SystemBack/getDictionaryData",
		type:"get",
		async:false,
		data:{dicCode:'goodsClass'},
	    success:function(res){
	    	$.each(res.data,function(index,item){
	    		$("#goods_class").append("<option value='"+item.code+"'>"+item.value+"</option>");
	    	})
	    }
	});
}

$("#form-article-add").validate({
	rules:{
		goods_name:{
			required:true
		},
		goods_class:{
			required:true
		},
		spec_sku:{
			required:true
		},
		spec_name:{
			required:true
		},
		spec_price:{
			required:true,
			number:true
		},
		price:{
			required:true,
			number:true
		},
		brand:{
			required:true
		},
		introducePrice:{
			number:true
		},
		firstBrand:{
			required:true
		},
		secondBrand:{
			required:true
		},
		iconImg:{
			required:true
		},
		imgList:{
			required:true
		},
		spec_Img:{
			required:true
		}
	},
	onkeyup:false,
	focusCleanup:true,
	success:"valid",
	submitHandler:function(form){
		$(form).ajaxSubmit({
				success: function(data){
					if(data.errcode=="0"){
						layer.msg('添加成功!');
						gotoGoodsList();
					}else{
						layer.msg(data.errmsg,{icon:2});
					}
					
				},
                error: function(XmlHttpRequest, textStatus, errorThrown){
					layer.msg('error!',{icon:2});
				}
			});
		
	}
});

function gotoGoodsList(){
	setTimeout(function(){
		var index = parent.layer.getFrameIndex(window.name);
		parent.$('#search').click();
		parent.layer.close(index);
	},3000);
	
}

function addSpec(obj){
	$(obj).parent().before($(".specItem").eq(0).prop("outerHTML"));
	$(".specItem:last").find("#spec_sku").val(getSkuSeq($("#goods_class option:selected").val()));
}

function delSpecItem(obj){
	if($("div.specItem").length<=1) return;
	$(obj).parent().remove();
}

function getSkuSeq(goods_class){
	var seq="";
	$.ajax({
		url:"SystemBack/getSkuSeq",
		type:"get",
		async:false,
		data:{goods_class:goods_class},
		success:function(res){
			seq=res.seq;
		}
	});
	return seq;
}
</script>
</html>