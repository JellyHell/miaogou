<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<style>
 .dashed{
   border:1px dashed #ddd;
   text-align: right;
   padding-left: 15px;
   padding-right: 15px;
 }
 .bottomShade{
    position: absolute;
    left: 0px;
    bottom: 0px;
    text-align:center;
    background: rgba(0,0,0,0.4);
    width: 100%;
    cursor: default;
 }
 .divhide{
    display: none;
 }
 .bottomShade i{
   cursor: pointer;
   font-size: 18px;
 }
 .specImg{
	 position:absolute;
	 left:0;
	 top:0;
	 width:100%;
	 height: 100px;
 }
</style>
<link href="static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css" />
<link href="lib/pagination/css/jquery.pagination.css" rel="stylesheet" type="text/css" />

<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>编辑商品</title>
</head>
<body>
<div class="page-container">
	<form action="SystemBack/addGoods" method="post" class="form form-horizontal" id="form-article-add">
	    <!-- <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>SKU：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="sku" name="sku">
			</div>
		</div> -->
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="goods_name" name="goods_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
				<select name="goods_class" id="goods_class" class="select">
				    
				</select>
				</span>
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>上架状态：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
				<select name="sale" id="sale" class="select">
					<option value="on">上架</option>
					<option value="off">下架</option>
				</select>
				</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="商品价格" id="price" name="price">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">增加规格</label>
			<div class="formControls col-xs-8 col-sm-9" >
			    <div class="dashed" style="padding-right: 20px;padding-top: 20px;padding-bottom: 20px;">
			      <div class="specItem" style="margin-bottom: 15px;">
				      <input type="text" style="width:24%" class="input-text" readonly value="" placeholder="请填写SKU" id="spec_sku" name="spec_sku">
				      <input type="text" style="width:24%" class="input-text" value="" placeholder="请填写规格名称" id="spec_name" name="spec_name">
				      <input type="text" style="width:24%;" class="input-text" value="" placeholder="请填写价格" id="spec_price" name="spec_price">
				      <div class="btn-upload form-group" style="width:22%;height:100px;">
						   <img class="specImg" >
						   <input type="hidden" name="uploadedImg" id="uploadedImg">
					       <div class="layui-layer-imgtit bottomShade divhide" >
					         <i class="Hui-iconfont" >&#xe6e2;</i>
					       </div> 
					  </div>
					 <i class="Hui-iconfont" style="cursor: pointer;" onclick="delSpecItem(this)">&#xe6e2;</i> 
				 </div>
				 <div style="margin-right: 77px;margin-top: 20px;">
				   <i class="Hui-iconfont" onclick="addSpec(this)" style="cursor: pointer;position: absolute;bottom: 5px;">&#xe600;增加规格</i>
			     </div>
			    </div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="品牌" id="brand" name="brand">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第一品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="firstBrand" name="firstBrand">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第二品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="secondBrand" name="secondBrand">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">相关链接：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="introduceUrl" name="introduceUrl">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">第三方参照价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="introducePrice" name="introducePrice">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品说明：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="introduce" id="introduce" cols="" rows="" class="textarea"  placeholder="" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" ></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">图标：</label>
			<div class="formControls col-xs-8 col-sm-9 diviconImg">
				<div class="btn-upload form-group iconImg"  style="width: 100px;height: 100px;">
				<img id="iconImg" style="width: 100px;height: 100px;"  >
				<!-- <input class="input-text upload-url" type="text" name="iconImg" id="iconImg" readonly nullmsg="请添加附件！" style="width:200px">
				<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" accept="image/*"  name="iconImgfile" class="input-file"> -->
				<div class="bottomShade divhide" style="height: 30px;">
				  <i class="Hui-iconfont" >&#xe6e2;</i>
				</div>
				</div>
			</div>
		</div>
	    <!-- <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">大图：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="btn-upload form-group">
				<input class="input-text upload-url" type="text" name="bigImg" id="bigImg" readonly nullmsg="请添加附件！" style="width:200px">
				<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
				<input type="file" accept="image/*"  name="bigImgfile" class="input-file">
				</span>
			</div>
		</div>  -->
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">图片列表：</label>
			<div class="formControls col-xs-8 col-sm-9 imgListDiv">
				<div class="btn-upload form-group imgList" style="width: 100px;height: 100px;margin-bottom: 10px;margin-left: 5px;">
				<img id="iconImg" style="width: 100px;height: 100px;"  >
						<div class="bottomShade divhide" style="height: 30px;">
					  <i class="Hui-iconfont" >&#xe6e2;</i>
					</div>
				</div>
				<div><img id="ImgPr" width="120" height="120" /></div>
                <input type="file" id="up" />
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button  class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i>提交</button>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="lib/pagination/js/jquery.pagination.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> 
</body>
<script>
var html='<div class="btn-upload form-group" style="width:22%">'+
            '<div><img class="divhide" id="specImg" style="width:100%;height:100px;"><div>'+
            ' <div class="layui-layer-imgtit bottomShade divhide" >'+
	        ' <i class="Hui-iconfont" >&#xe6e2;</i>'+
	        ' </div> '+
			'<a   class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>'+
			 '<input type="file" accept="image/*" id="specImgFile" style="width:0px;height:0px;"  name="specImgFile" class="input-file">'+
		'</div>';
		
var html2='<div class="btn-upload form-group iconImg" style="width:22%">'+
            '<div><img class="divhide" id="specImg" style="width:100%;height:100px;"><div>'+
            ' <div class="layui-layer-imgtit bottomShade divhide" >'+
	        ' <i class="Hui-iconfont" >&#xe6e2;</i>'+
	        ' </div> '+
			'<a  class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>'+
			'<input type="file" accept="image/*" style="width:0px;height:0px;" id="specImgFile" name="iconImgfile" class="input-file">'+
			'</div>';
			
var  specItemHtml='<div class="specItem" style="margin-bottom: 15px;">'+
				   ' <input type="text" style="width:24%" class="input-text" readonly value="" placeholder="请填写SKU" id="spec_sku" name="spec_sku">'+
				'<input type="text" style="width:24%" class="input-text" value="" placeholder="请填写规格名称" id="spec_name" name="spec_name">'+
				'<input type="text" style="width:24%;" class="input-text" value="" placeholder="请填写价格" id="spec_price" name="spec_price">'+
				 html+
				'<i class="Hui-iconfont" style="cursor: pointer;" onclick="delSpecItem(this)">&#xe6e2;</i> '+
				'</div>';
$(function(){
	//获取商品类别列表
	initGoodsClass();
	//获取该商品的基本信息
	getGoodsData(GetQueryString("goods_code"));
	
	//点击按钮触发  文件选择事件
	$("div.dashed").delegate(".specItem .btn-upload .upload-btn","click",function(){
	     $(this).next().trigger("click");
	});
	
	$("div.diviconImg").delegate("a.upload-btn","click",function(){
		 $(this).next().trigger("click");
	});
	
	//绑定规格图片hover事件
	$("div.dashed").delegate(".specItem .btn-upload","mouseenter",function(){
		if($(this).find("a.upload-btn").length>0&&$(this).find("a.upload-btn").is(":visible")) return true;
	     $(this).find(".bottomShade").show();
	});
	
	//绑定规格图片hover事件
	$("div.dashed").delegate(".specItem .btn-upload","mouseleave",function(){
		if($(this).find("a.upload-btn").length>0&&$(this).find("a.upload-btn").is(":visible")) return true;
	     $(this).find(".bottomShade").hide();
	});
	
	//绑定icon图片hover事件
	$("div.diviconImg").delegate(".btn-upload","mouseenter",function(event){
		if($(this).find("a.upload-btn").length>0&&$(this).find("a.upload-btn").is(":visible")) return true;
	     $(this).find(".bottomShade").show();
	});
	
	//绑定icon图片hover事件
	$("div.diviconImg").delegate(".btn-upload","mouseleave",function(event){
		if($(this).find("a.upload-btn").length>0&&$(this).find("a.upload-btn").is(":visible")) return true;
	     $(this).find(".bottomShade").hide();
	});
	
	//删除规格图片事件
	$("div.dashed").delegate(".specItem .btn-upload i","click",function(){
		var specItem=$(this).parents(".specItem");
		$(this).parents(".btn-upload").hide();
		$(this).parents(".btn-upload").after(html);	
		$(this).parents(".btn-upload").remove();
	});
	
	//删除icon图片事件
	$("div.diviconImg").delegate(".btn-upload i","click",function(){
		$(this).parents(".btn-upload").hide();
		$(this).parents(".btn-upload").after(html2);	
		$(this).parents(".btn-upload").remove();
	});
	
	
	//预览规格图片
	$("div.dashed").delegate(".specItem #specImgFile","change",function(){
		$(this).prev().hide();
		$(this).parents(".btn-upload").height("100px").find("img").attr("src",getSelectFileUrl(this)).removeClass("divhide");
	})
	
	//预览icon图片
	$("div.diviconImg").delegate("#specImgFile","change",function(){
		$(this).prev().hide();
		$(this).parents(".btn-upload").height("100px").find("img").attr("src",getSelectFileUrl(this)).removeClass("divhide");
	});
	
	//iconImg hover 事件显示删除按钮
	$("div.iconImg").hover(function(){
		$(this).find(".bottomShade").show();
	},function(){
		$(this).find(".bottomShade").hide();
	});
	
	//iconImg 删除
	$("div.iconImg .bottomShade i").click(function(){
		$(this).parents(".iconImg").hide();
		$(this).parents(".iconImg").after(html2);
		$(this).parents(".iconImg").remove();
	});
	
	//imgList hover事件
	$("div.imgListDiv").delegate(".imgList","mouseenter mouseleave",function(event){
	     $(this).find(".bottomShade").toggleClass("divhide");
	});
	//delete 
	$("div.imgListDiv").delegate(".imgList i","click",function(){
	     $(this).parents(".imgList").remove();
	});
});

//初始化商品类别
function initGoodsClass(){
	$.ajax({
		url:"SystemBack/getDictionaryData",
		type:"get",
		data:{dicCode:'goodsClass'},
	    success:function(res){
	    	$.each(res.data,function(index,item){
	    		$("#goods_class").append("<option value='"+item.code+"'>"+item.value+"</option>");
	    	})
	    }
	});
	
}

//获取所编辑的内容 并进行设置
function getGoodsData(goods_code){
	$.ajax({
		url:"SystemBack/getGoodsData",
		data:{goods_code:goods_code},
		type:"get",
		success:function(res){
			setData(res);
		}
	});
}

function setData(res){
	console.log(res);
	$("#goods_name").val(res.goodsInfo.goods_name);
	$("#goods_class option[value='"+res.goodsInfo.goods_class+"']").attr("selected",true);
	$("#sale option[value='"+res.goodsInfo.sale+"']").attr("selected",true);
	$("#price").val(res.goodsInfo.price);
	$("#brand").val(res.goodsInfo.brand);
	$("#firstBrand").val(res.goodsInfo.firstBrand);
	$("#secondBrand").val(res.goodsInfo.secondBrand);
	$("#introduceUrl").val(res.goodsInfo.introduceUrl);
	$("#introducePrice").val(res.goodsInfo.introducePrice);
	$("#introduce").val(res.goodsInfo.introduce);
	$("#iconImg").attr("src",res.goodsInfo.iconImg);
	
	//设置规格
	for(var i=0;i<res.specList.length-1;i++){
		$("div.dashed").prepend($(".specItem").eq(0).prop("outerHTML"));
	}
	
	$(".specItem").each(function(index,item){
		$(this).find("#spec_sku").val(res.specList[index].sku);
		$(this).find("#spec_name").val(res.specList[index].spec_name);
		$(this).find("#spec_price").val(res.specList[index].price);
		$(this).find("#uploadedImg").val(res.specList[index].url);
		$(this).find("img").attr("src",res.specList[index].url);
	});
	
	//设置大图列表
	
	for(var i=0;i<res.imgList.length-1;i++){
		$("div.imgListDiv").prepend($(".imgList").eq(0).prop("outerHTML"));
	}
	
	$(".imgList").each(function(index,item){
		$(this).find("img").attr("src",res.imgList[index].url);
	});
	
	
	
	
}
function addSpec(obj){
	$(obj).parent().before($(".specItem").eq(0).prop("outerHTML"));
	$(".specItem:last").find("div.btn-upload").remove();
	$(".specItem:last").find("i").before(html);
}

function delSpecItem(obj){
	if($("div.specItem").length<=1) return;
	$(obj).parent().remove();
}

function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
}
</script>
</html>