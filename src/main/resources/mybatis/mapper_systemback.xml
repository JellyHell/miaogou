<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.miaogou.dao.ISystemBackDao">

	<select id="getGoodsList" parameterType="Map" resultType="Map">
			SELECT
			a.goods_code,
			a.goods_name,
			a.goods_class,
			a.price,
			a.iconImg,
			a.sale,
			a.sku,
			b.brand,
			b.firstBrand,
			b.secondBrand,
			b.introduce,
			b.introducePrice,
			b.introduceUrl,
			GROUP_CONCAT(
				c.`code`,
				'#',
				c.url,
				'#',
				IFNULL(c.isBigImg, '0')
			) imglist
		FROM
			mg_goods a
		LEFT JOIN mg_goodsdetails b ON a.goods_code = b.goods_code
		LEFT JOIN mg_attachment c ON a.goods_code = c.tabCode
		
		<where>
		   <if test="key!=null and key!=''"> 
		    and a.goods_name like CONCAT(CONCAT('%',#{key}),'%')
		   </if>
	    </where>
		
		GROUP BY
			a.goods_code,
			a.goods_name,
			a.goods_class,
			a.price,
			a.iconImg,
			b.brand,
			b.firstBrand,
			b.secondBrand,
			b.introduce,
			b.introducePrice,
			b.introduceUrl
	</select>
	<select id="SkuExits" parameterType="Map" resultType="java.lang.Integer">
	 select count(1) from mg_goods where sku=#{sku}
	</select>
	<insert id="inserIntoGoods" parameterType="Map">
	INSERT INTO mg_goods (`goods_code`, `sku`,`goods_class`, `goods_name`, `price`,  
                `iconImg`, `group`, `remote`,`sale`) 
                VALUES (#{goods_code}, #{sku},#{goods_class},#{goods_name},#{price},#{iconImg},#{group},#{remote},#{sale})
	</insert>
	<insert id="inserIntoGoodsDetails" parameterType="Map">
	 INSERT INTO mg_goodsdetails (`goods_code`, `brand`, `firstBrand`, `secondBrand`, `introduceUrl`, 
	 `introducePrice`, `introduce`)
      VALUES (#{goods_code}, #{brand}, #{firstBrand}, #{secondBrand}, #{introduceUrl}, #{introducePrice}, #{introduce})
	</insert>
	
	<insert id="inserIntoAttachmentbigImg" parameterType="Map">
	 INSERT INTO mg_attachment (`code`, `tabCode`, `groupName`, `remoteName`, `url`, `isBigImg`, `createTime`) 
		VALUES (#{code}, #{tabCode}, #{groupName}, #{remoteName}, 
		#{url}, '1', SYSDATE())
	</insert>
	<insert id="inserIntoAttachment" parameterType="Map">
	 INSERT INTO mg_attachment (`code`, `tabCode`, `groupName`, `remoteName`, `url`, `createTime`) 
		VALUES (#{code}, #{tabCode}, #{groupName}, #{remoteName}, 
		#{url}, SYSDATE())
	</insert>
	<select id="userExists" parameterType="java.lang.String" resultType="java.lang.Integer">
	 select count(1) from sys_user where username=#{_parameter}
	</select>
	<select id="passwordRight" parameterType="Map" resultType="java.lang.Integer">
	 select count(1) from sys_user where username=#{username} and password=#{password}
	</select>
	<select id="getAttachmentBytabCode" parameterType="Map" resultType="Map">
	 select groupName,remoteName,url from mg_attachment where tabCode=#{goods_code}
	</select>
	<select id="getGoodsItem" parameterType="Map" resultType="Map">
	 select * from mg_goods where goods_code=#{goods_code}
	</select>
	<update id="attachemntDelBytabCode" parameterType="Map">
	 delete from mg_attachment where tabCode=#{goods_code}
	</update>
	<update id="delGoodsDetails" parameterType="Map">
     delete from mg_goodsdetails where goods_code=#{goods_code}
	</update>
	<update id="delGoods" parameterType="Map">
	 delete from mg_goods where goods_code=#{goods_code}
	</update>
	
	<update id="GoodsSaleStatusChange" parameterType="Map">
	 update mg_goods set sale=#{sale} where goods_code=#{goods_code}
	</update>
	<select id="getOrderList" resultType="Map">
     select 
		a.out_trade_no,a.transaction_id,a.total_fee,DATE_FORMAT(a.createTime,'%Y-%c-%d %T') createTime,a.state,
		b.nickName,c.`name`,c.phone,c.area,c.address
		from mg_order a left join mg_wxUser b on a.openId=b.openId left join mg_order_delivery_address c 
		on a.out_trade_no=c.out_trade_no
    </select>
</mapper>