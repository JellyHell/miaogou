<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.miaogou.dao.IUserDao">

	<select id="findGoodsByClass" parameterType="Map" resultType="Map">
	 select * from mg_goods where goods_class=#{goods_class}
	</select>
	
	<select id="getBannerAd" resultType="Map">
	 select * from mg_banner_ad where status='1' order by banner_index
	</select>
	
	<select id="nextval" parameterType="java.lang.String" resultType="java.lang.String">
     select nextval(#{_parameter}) from dual
    </select>
    
    <insert id="addDeliveryAddress" parameterType="Map">
    INSERT INTO mg_delivery_address 
    <trim prefix="(" suffix=")" suffixOverrides=",">
         <if test="code !=null and code !=''">code,</if>
         <if test="openId !=null and openId !=''">openId,</if>
         <if test="name !=null and name !=''">name,</if>
         <if test="phone !=null and phone !=''">phone,</if>
         <if test="area !=null and area !=''">area,</if>
         <if test="address !=null and address !=''">address,</if>
         <if test="postCode !=null and postCode !=''">postCode,</if>
      </trim>
      <trim prefix="values (" suffix=")" suffixOverrides=",">
         <if test="code !=null and code !=''">#{code},</if>
         <if test="openId !=null and openId !=''">#{openId},</if>
         <if test="name !=null and name !=''">#{name},</if>
         <if test="phone !=null and phone !=''">#{phone},</if>
         <if test="area !=null and area !=''">#{area},</if>
         <if test="address !=null and address !=''">#{address},</if>
         <if test="postCode !=null and postCode !=''">#{postCode},</if>
      </trim>
    </insert>
    
    <select id="getDeliveryAddress" parameterType="Map" resultType="Map">
     select * from mg_delivery_address where openId=#{openId}
    </select>
    
    <update id="delDeliveryAddress" parameterType="Map">
     delete from mg_delivery_address where code=#{code} and openId=#{openId}
    </update>
    
    <update id="setAllNotDefaultAddress" parameterType="Map" >
     update mg_delivery_address set isDefault='0' where openId=#{openId}
    </update>
    
    <update id="setDefaultDeliveryAddress" parameterType="Map">
     update mg_delivery_address set isDefault='1' where code=#{code} and openId=#{openId}
    </update>
    
    <select id="getBestSalesGoods" parameterType="Map" resultType="Map">
     select * from mg_goods order by goods_salenum desc
    </select>
    
    <insert id="register" parameterType="Map">
    INSERT INTO `mg_register` (`openId`, `register_time`) VALUES (#{openId}, SYSDATE())
    </insert>
    
    <select id="isRegister" parameterType="Map" resultType="java.lang.Integer">
      select count(1) from mg_register where openId=#{openId} and TO_DAYS(register_time)=TO_DAYS(SYSDATE())
    </select>
    
    <insert id="addScore" parameterType="Map">
	    INSERT INTO `mg_score` (`code`, `openId`, `score`, `reason`, `score_time`) 
	    VALUES (#{code}, #{openId}, #{score}, #{reason}, SYSDATE())
    </insert>
    
    <select id="getScoreList" parameterType="Map" resultType="Map">
     select * from mg_score where openId=#{openId} order by score_time desc
    </select>
</mapper>